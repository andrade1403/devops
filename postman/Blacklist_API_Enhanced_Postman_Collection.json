{
  "info": {
    "name": "Blacklist API - Enhanced Validation Tests",
    "description": "API REST completa con validaciones robustas y scripts de prueba automatizados",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "enhanced-12345678-1234-1234-1234-123456789abc"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{auth_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "auth_token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üîë Authentication",
      "item": [
        {
          "name": "Generar Token JWT",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/blacklists/token",
              "host": ["{{base_url}}"],
              "path": ["blacklists", "token"]
            },
            "description": "Genera un token JWT v√°lido para autenticar las siguientes peticiones a la API."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Validaciones autom√°ticas del token",
                  "pm.test('Response status is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has token property', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('token');",
                  "});",
                  "",
                  "pm.test('Token is a valid string', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.token).to.be.a('string');",
                  "    pm.expect(responseJson.token.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "pm.test('Token has JWT format', function () {",
                  "    const responseJson = pm.response.json();",
                  "    const tokenParts = responseJson.token.split('.');",
                  "    pm.expect(tokenParts).to.have.lengthOf(3);",
                  "});",
                  "",
                  "// Guardar token autom√°ticamente",
                  "if (pm.response.code === 200) {",
                  "    const responseJson = pm.response.json();",
                  "    pm.environment.set('auth_token', responseJson.token);",
                  "    console.log('‚úÖ Token guardado autom√°ticamente');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üìã Gesti√≥n de Lista Negra - Casos Exitosos",
      "item": [
        {
          "name": "‚úÖ Agregar Email V√°lido",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"usuario.bloqueado@ejemplo.com\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"reason\": \"Spam reportado m√∫ltiples veces\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email agregado exitosamente', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has success message', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('msg');",
                  "    pm.expect(responseJson.msg).to.include('exitosamente');",
                  "});",
                  "",
                  "pm.test('Response time is acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚úÖ Email sin Raz√≥n (Campo Opcional)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"sin.razon@ejemplo.com\",\n    \"appId\": \"99999999-8888-7777-6666-555555555555\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email sin raz√≥n agregado exitosamente', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Campo reason es opcional', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('exitosamente');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{auth_token}}",
            "type": "string"
          }
        ]
      }
    },
    {
      "name": "‚ùå Validaciones de Error - JSON y Estructura",
      "item": [
        {
          "name": "‚ùå JSON Inv√°lido",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@ejemplo.com\",\n    \"appId\": \"invalid-json\"\n    // JSON malformado sin coma"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('JSON inv√°lido retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error message menciona JSON inv√°lido', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('JSON v√°lido');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå Body Vac√≠o",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Body vac√≠o retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error message menciona body vac√≠o', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('vac√≠o');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå Campos Faltantes",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"usuario@ejemplo.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Campos faltantes retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error espec√≠fico para campos faltantes', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('necesarios');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{auth_token}}",
            "type": "string"
          }
        ]
      }
    },
    {
      "name": "‚ùå Validaciones de Error - Campos Vac√≠os",
      "item": [
        {
          "name": "‚ùå Email Vac√≠o",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email vac√≠o retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error espec√≠fico para email vac√≠o', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('email no puede estar vac√≠o');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå AppId Vac√≠o",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@ejemplo.com\",\n    \"appId\": \"\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('AppId vac√≠o retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error espec√≠fico para appId vac√≠o', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('appId no puede estar vac√≠o');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå Email Solo Espacios",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"   \",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email con solo espacios retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Trim funciona correctamente', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('email no puede estar vac√≠o');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{auth_token}}",
            "type": "string"
          }
        ]
      }
    },
    {
      "name": "‚ùå Validaciones de Error - Formato Inv√°lido",
      "item": [
        {
          "name": "‚ùå Email Formato Inv√°lido",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"email-invalido\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email inv√°lido retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error espec√≠fico para formato de email', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('formato v√°lido');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå UUID Inv√°lido",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@ejemplo.com\",\n    \"appId\": \"not-a-uuid\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('UUID inv√°lido retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error espec√≠fico para UUID inv√°lido', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('UUID v√°lido');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå Reason Muy Largo (>255 caracteres)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@ejemplo.com\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"reason\": \"Este es un texto muy largo que excede los 255 caracteres permitidos para el campo reason. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Reason muy largo retorna error 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error espec√≠fico para longitud de reason', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('255 caracteres');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{auth_token}}",
            "type": "string"
          }
        ]
      }
    },
    {
      "name": "‚ùå Validaciones de Autenticaci√≥n",
      "item": [
        {
          "name": "‚ùå Sin Token de Autorizaci√≥n",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@ejemplo.com\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Sin token retorna error 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Error de autorizaci√≥n', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('msg');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "‚ùå Token Inv√°lido",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer token-invalido"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@ejemplo.com\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Token inv√°lido retorna error 422', function () {",
                  "    pm.response.to.have.status(422);",
                  "});",
                  "",
                  "pm.test('Error de token inv√°lido', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('msg');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üß™ Casos Edge - Normalizaci√≥n",
      "item": [
        {
          "name": "üß™ Email con Espacios y May√∫sculas",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"  TEST.USER@EJEMPLO.COM  \",\n    \"appId\": \"  550e8400-e29b-41d4-a716-446655440000  \",\n    \"reason\": \"  Prueba de normalizaci√≥n  \"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Normalizaci√≥n funciona correctamente', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Email y datos normalizados correctamente', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('exitosamente');",
                  "});",
                  "",
                  "// Nota: La normalizaci√≥n convierte email a min√∫sculas y quita espacios"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "üß™ Caracteres Especiales en Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"user+tag@example-domain.co.uk\",\n    \"appId\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"reason\": \"Email con caracteres especiales v√°lidos\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/blacklists",
              "host": ["{{base_url}}"],
              "path": ["blacklists"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email con caracteres especiales v√°lidos', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Caracteres especiales aceptados correctamente', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.msg).to.include('exitosamente');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{auth_token}}",
            "type": "string"
          }
        ]
      }
    },
    {
      "name": "üè• Health Check",
      "item": [
        {
          "name": "Verificar Estado del Servicio",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/blacklists/health",
              "host": ["{{base_url}}"],
              "path": ["blacklists", "health"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Health check retorna 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contiene status pong', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('status', 'pong');",
                  "});",
                  "",
                  "pm.test('No requiere autenticaci√≥n', function () {",
                  "    pm.expect(pm.request.headers.get('Authorization')).to.be.undefined;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script global - Pre-request",
          "console.log('üöÄ Ejecutando:', pm.info.requestName);",
          "console.log('üìã URL:', pm.request.url.toString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script global - Post-response",
          "console.log('‚úÖ Status:', pm.response.code);",
          "console.log('‚è±Ô∏è Tiempo:', pm.response.responseTime + 'ms');",
          "",
          "// Validaci√≥n global de headers",
          "pm.test('Response has Content-Type header', function () {",
          "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "});",
          "",
          "// Validaci√≥n global de tiempo de respuesta",
          "pm.test('Response time is acceptable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});"
        ]
      }
    }
  ]
}